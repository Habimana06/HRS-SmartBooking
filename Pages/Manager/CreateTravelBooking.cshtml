@page "/Manager/CreateTravelBooking"
@model HRS_SmartBooking.Pages.Manager.CreateTravelBookingModel
@{
    ViewData["Title"] = "Create Travel Booking";
}

<section class="reception-page manager-page">
    <header class="reception-header">
        <div>
            <p class="eyebrow">Travel & Attractions</p>
            <h1>@(Model.IsEditMode ? "Edit Travel Booking" : "Create Travel Booking")</h1>
            <p>@(Model.IsEditMode ? "Update travel booking details and pricing." : "Create a new travel booking for a customer with custom pricing.")</p>
        </div>
        @if (Model.IsEditMode)
        {
            <div class="header-actions">
                <a asp-page="/Manager/ManageTravelBookings" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left me-2"></i>
                    Back to List
                </a>
            </div>
        }
    </header>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-circle me-2"></i>@Model.ErrorMessage
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
    {
        <div class="alert alert-success" role="alert">
            <i class="bi bi-check-circle me-2"></i>@Model.SuccessMessage
        </div>
    }

    <form method="post" class="booking-grid">
        <div class="glass-panel">
            <h2>Customer & Attraction Details</h2>
            <div class="form-grid">
                <div class="col-span-2">
                    <label>Customer</label>
                    <select asp-for="Input.CustomerId" required>
                        <option value="">Select customer</option>
                        @foreach (var customer in Model.Customers)
                        {
                            <option value="@customer.UserId">@customer.FirstName @customer.LastName (@customer.Email)</option>
                        }
                    </select>
                    <span asp-validation-for="Input.CustomerId" class="text-danger"></span>
                </div>
                <div class="col-span-2">
                    <label>Attraction Name</label>
                    <input type="text" asp-for="Input.AttractionName" placeholder="e.g., Volcanoes National Park" required />
                    <span asp-validation-for="Input.AttractionName" class="text-danger"></span>
                </div>
                <div>
                    <label>Attraction Type</label>
                    <select asp-for="Input.AttractionType" required>
                        <option value="Nature">Nature</option>
                        <option value="Adventure">Adventure</option>
                        <option value="Wildlife">Wildlife</option>
                        <option value="Culture">Culture</option>
                    </select>
                    <span asp-validation-for="Input.AttractionType" class="text-danger"></span>
                </div>
                <div>
                    <label>Travel Date</label>
                    <input type="date" asp-for="Input.TravelDate" min="@DateTime.Today.ToString("yyyy-MM-dd")" required />
                    <span asp-validation-for="Input.TravelDate" class="text-danger"></span>
                </div>
                <div>
                    <label>Number of Participants</label>
                    <input type="number" asp-for="Input.NumberOfParticipants" min="1" max="20" value="2" required />
                    <span asp-validation-for="Input.NumberOfParticipants" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="glass-panel">
            <h2>Pricing & Payment</h2>
            <div class="form-grid">
                <div>
                    <label>Price per Person (RWF)</label>
                    <input type="number" asp-for="Input.PricePerPerson" min="0" step="0.01" id="pricePerPerson" required />
                    <span asp-validation-for="Input.PricePerPerson" class="text-danger"></span>
                </div>
                <div>
                    <label>Number of Participants</label>
                    <input type="number" id="participants" value="2" min="1" max="20" readonly />
                </div>
                <div class="col-span-2">
                    <label>Total Price (RWF)</label>
                    <input type="text" id="totalPrice" readonly class="form-control-lg" style="font-size: 1.5rem; font-weight: bold;" />
                    <input type="hidden" asp-for="Input.TotalPrice" id="totalPriceHidden" />
                </div>
                <div class="col-span-2">
                    <label>Payment Method</label>
                    <select asp-for="Input.PaymentMethod" required>
                        <option value="">Select payment method</option>
                        <option value="Card">Credit/Debit Card</option>
                        <option value="MTN MoMo">MTN Mobile Money</option>
                        <option value="Cash">Cash</option>
                    </select>
                    <span asp-validation-for="Input.PaymentMethod" class="text-danger"></span>
                </div>
                <div class="col-span-2">
                    <label>Special Requests</label>
                    <textarea asp-for="Input.SpecialRequests" rows="3" placeholder="Any special requests or notes..."></textarea>
                </div>
            </div>
        </div>

        <div class="glass-panel">
            <h2>Booking Status</h2>
            <div class="form-grid">
                <div>
                    <label>Booking Status</label>
                    <select asp-for="Input.BookingStatus" required>
                        <option value="pending">Pending</option>
                        <option value="confirmed" selected>Confirmed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div>
                    <label>Payment Status</label>
                    <select asp-for="Input.PaymentStatus" required>
                        <option value="pending">Pending</option>
                        <option value="paid" selected>Paid</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn btn-gradient w-100 mt-3">
                <i class="bi bi-calendar-check me-2"></i>
                @(Model.IsEditMode ? "Update Travel Booking" : "Create Travel Booking")
            </button>
        </div>
    </form>
</section>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const pricePerPerson = document.getElementById('pricePerPerson');
            const participants = document.getElementById('participants');
            const totalPrice = document.getElementById('totalPrice');
            const totalPriceHidden = document.getElementById('totalPriceHidden');
            const participantsInput = document.querySelector('input[name="Input.NumberOfParticipants"]');

            function calculateTotal() {
                const price = parseFloat(pricePerPerson.value) || 0;
                const count = parseInt(participantsInput.value) || 0;
                const total = price * count;
                totalPrice.value = total.toLocaleString('en-US') + ' RWF';
                totalPriceHidden.value = total;
            }

            pricePerPerson.addEventListener('input', calculateTotal);
            participantsInput.addEventListener('input', function() {
                participants.value = this.value;
                calculateTotal();
            });

            // Initialize
            participants.value = participantsInput.value;
            calculateTotal();
        });
    </script>
}

