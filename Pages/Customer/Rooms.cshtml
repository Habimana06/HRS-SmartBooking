@page "/Customer/Rooms"
@model HRS_SmartBooking.Pages.Customer.RoomsModel
@{
    ViewData["Title"] = "Rooms";
}

@functions {
    string GetAmenityIcon(string amenity)
    {
        var lower = amenity.ToLower();
        if (lower.Contains("wifi") || lower.Contains("wi-fi")) return "bi-wifi";
        if (lower.Contains("tv")) return "bi-tv";
        if (lower.Contains("shower") || lower.Contains("bath")) return "bi-droplet";
        if (lower.Contains("safe")) return "bi-shield-lock";
        if (lower.Contains("bar")) return "bi-cup-straw";
        if (lower.Contains("parking")) return "bi-p-circle";
        if (lower.Contains("pool")) return "bi-water";
        if (lower.Contains("gym") || lower.Contains("fitness")) return "bi-activity";
        if (lower.Contains("breakfast")) return "bi-cup-hot";
        if (lower.Contains("spa")) return "bi-flower1";
        return "bi-star";
    }
}

<section class="customer-section rooms-hero" id="roomsHeroSection">
    <div class="rooms-hero-background">
        <div class="rooms-hero-slide active" style="background-image: url('/images/forest1.jpg');"></div>
        <div class="rooms-hero-slide" style="background-image: url('/images/forest2.jpg');"></div>
        <div class="rooms-hero-slide" style="background-image: url('/images/forest3.jpg');"></div>
        <div class="rooms-hero-slide" style="background-image: url('/images/forest4.jpeg');"></div>
        <div class="rooms-hero-slide" style="background-image: url('/images/forest5.jpg');"></div>
        <div class="rooms-hero-slide" style="background-image: url('/images/forest6.jpg');"></div>
        <div class="rooms-hero-overlay"></div>
    </div>
    <div class="rooms-hero-content">
        <p class="eyebrow">Rooms</p>
        <h1>All room categories at a glance</h1>
        <p>Multi-column grid with filter sidebar, hover zoom, tag chips, and button slide-in animations.</p>
    </div>
    <div class="rooms-filters glass-panel">
        <div class="filter-row">
            <label>Price range</label>
            <input type="range" id="priceRange" min="120" max="800" value="420" />
            <span id="priceDisplay">Up to RWF 504,000</span>
        </div>
        <div class="filter-row">
            <label>Room mood</label>
            <div class="chip-row">
                <button type="button" class="chip active">Suites</button>
                <button type="button" class="chip">Lofts</button>
                <button type="button" class="chip">Villas</button>
                <button type="button" class="chip">Studios</button>
            </div>
        </div>
        <div class="filter-row">
            <label>Sort by</label>
            <select>
                <option>Recommended</option>
                <option>Price (low-high)</option>
                <option>Guest rating</option>
            </select>
        </div>
    </div>
</section>

<section class="customer-section">
    <div class="room-grid upgraded" id="roomsGrid">
        @{ var roomIndex = 0; }
        @foreach (var room in Model.Rooms)
        {
            <article class="room-card glow-card @(roomIndex < 9 ? "visible" : "")" data-room-index="@roomIndex">
                <div class="room-media room-image-carousel" data-room-id="@room.RoomId">
                    @{ var imgIndex = 0; }
                    @foreach (var imageUrl in room.ImageUrls)
                    {
                        <div class="room-image-slide @(imgIndex == 0 ? "active" : "")" style="background-image:url('@imageUrl');"></div>
                        imgIndex++;
                    }
                    <span class="badge badge-glow">Available</span>
                    @if (room.ImageUrls.Count > 1)
                    {
                        <div class="room-image-dots">
                            @for (int i = 0; i < room.ImageUrls.Count; i++)
                            {
                                <span class="@(i == 0 ? "active" : "")" data-slide="@i"></span>
                            }
                        </div>
                    }
                </div>
                <div class="room-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h3>@room.Name</h3>
                            <p>@room.Details</p>
                        </div>
                        <strong>@room.Price<span class="text-muted fs-6"> / night</span></strong>
                    </div>
                    <div class="room-meta">
                        <span><i class="bi bi-star-fill text-warning"></i> @room.Rating.ToString("F1")</span>
                        <span><i class="bi bi-person"></i> @room.Details.Split("•").FirstOrDefault()?.Trim()</span>
                        <span><i class="bi bi-lightning-charge"></i> @room.Features.FirstOrDefault() ?? "Wi-Fi"</span>
                    </div>
                    <div class="room-actions">
                        <a asp-page="/Customer/RoomDetails" asp-route-id="@room.RoomId" class="btn btn-outline-light">View details</a>
                        <a asp-page="/Customer/Booking" asp-route-roomId="@room.RoomId" class="btn btn-gradient">Reserve</a>
                    </div>
                </div>
            </article>
            roomIndex++;
        }
    </div>
    <div class="pagination" id="roomsPagination">
        <button class="btn btn-outline-light" id="prevPageBtn" disabled>
            <i class="bi bi-arrow-left"></i> Previous
        </button>
        <div class="page-dots" id="pageDots">
            <!-- Dots will be generated by JavaScript -->
        </div>
        <button class="btn btn-gradient" id="nextPageBtn">
            Next <i class="bi bi-arrow-right"></i>
        </button>
    </div>
</section>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const priceRange = document.getElementById('priceRange');
            const priceDisplay = document.getElementById('priceDisplay');
            const currency = '@Model.Currency';
            const exchangeRate = currency === 'RWF' ? 1200 : 1;
            
            if (priceRange && priceDisplay) {
                function updatePriceDisplay() {
                    const usdValue = parseInt(priceRange.value);
                    const displayValue = currency === 'RWF' ? usdValue * exchangeRate : usdValue;
                    const formattedPrice = currency === 'RWF' 
                        ? `RWF ${displayValue.toLocaleString()}`
                        : `$${displayValue.toLocaleString()}`;
                    priceDisplay.textContent = `Up to ${formattedPrice}`;
                }
                
                priceRange.addEventListener('input', updatePriceDisplay);
                updatePriceDisplay();
            }

            // Auto-slide for rooms hero background
            const roomsHeroSection = document.getElementById('roomsHeroSection');
            if (roomsHeroSection) {
                const heroSlides = roomsHeroSection.querySelectorAll('.rooms-hero-slide');
                if (heroSlides.length > 1) {
                    let currentHeroSlide = 0;
                    const heroSlideInterval = 5000; // 5 seconds
                    
                    function showHeroSlide(index) {
                        heroSlides.forEach((slide, i) => {
                            if (i === index) {
                                slide.classList.add('active');
                            } else {
                                slide.classList.remove('active');
                            }
                        });
                    }
                    
                    function nextHeroSlide() {
                        currentHeroSlide = (currentHeroSlide + 1) % heroSlides.length;
                        showHeroSlide(currentHeroSlide);
                    }
                    
                    // Initialize
                    showHeroSlide(0);
                    setInterval(nextHeroSlide, heroSlideInterval);
                }
            }

            // Auto-slide for room images
            const roomCarousels = document.querySelectorAll('.room-image-carousel');
            roomCarousels.forEach(carousel => {
                const slides = carousel.querySelectorAll('.room-image-slide');
                const dots = carousel.querySelectorAll('.room-image-dots span');
                
                if (slides.length <= 1) return; // Skip if only one image
                
                let currentSlide = 0;
                const slideInterval = 4000; // 4 seconds
                let autoSlideInterval;
                
                function showSlide(index) {
                    slides.forEach((slide, i) => {
                        if (i === index) {
                            slide.classList.add('active');
                        } else {
                            slide.classList.remove('active');
                        }
                    });
                    if (dots.length > 0) {
                        dots.forEach((dot, i) => {
                            if (i === index) {
                                dot.classList.add('active');
                            } else {
                                dot.classList.remove('active');
                            }
                        });
                    }
                }
                
                function nextSlide() {
                    currentSlide = (currentSlide + 1) % slides.length;
                    showSlide(currentSlide);
                }
                
                function startAutoSlide() {
                    autoSlideInterval = setInterval(nextSlide, slideInterval);
                }
                
                // Initialize
                showSlide(0);
                setTimeout(startAutoSlide, 1000);
                
                // Pause on hover
                carousel.addEventListener('mouseenter', () => {
                    if (autoSlideInterval) {
                        clearInterval(autoSlideInterval);
                    }
                });
                
                carousel.addEventListener('mouseleave', () => {
                    startAutoSlide();
                });
                
                // Dot navigation
                dots.forEach((dot, index) => {
                    dot.addEventListener('click', () => {
                        if (autoSlideInterval) {
                            clearInterval(autoSlideInterval);
                        }
                        currentSlide = index;
                        showSlide(currentSlide);
                        setTimeout(startAutoSlide, 1000);
                    });
                });
            });

            // Pagination functionality
            const roomsGrid = document.getElementById('roomsGrid');
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            const pageDots = document.getElementById('pageDots');
            const roomCards = roomsGrid ? Array.from(roomsGrid.querySelectorAll('.room-card')) : [];
            
            if (roomCards.length > 0) {
                const cardsPerPage = 9; // 3 rows × 3 columns
                const totalPages = Math.ceil(roomCards.length / cardsPerPage);
                let currentPage = 0;

                function showPage(page) {
                    const startIndex = page * cardsPerPage;
                    const endIndex = startIndex + cardsPerPage;

                    roomCards.forEach((card, index) => {
                        if (index >= startIndex && index < endIndex) {
                            card.classList.add('visible');
                        } else {
                            card.classList.remove('visible');
                        }
                    });

                    // Update pagination buttons
                    prevBtn.disabled = page === 0;
                    nextBtn.disabled = page >= totalPages - 1;

                    // Update dots
                    updateDots();
                }

                function updateDots() {
                    pageDots.innerHTML = '';
                    for (let i = 0; i < totalPages; i++) {
                        const dot = document.createElement('span');
                        if (i === currentPage) {
                            dot.classList.add('active');
                        }
                        dot.addEventListener('click', () => {
                            currentPage = i;
                            showPage(currentPage);
                        });
                        pageDots.appendChild(dot);
                    }
                }

                prevBtn.addEventListener('click', () => {
                    if (currentPage > 0) {
                        currentPage--;
                        showPage(currentPage);
                    }
                });

                nextBtn.addEventListener('click', () => {
                    if (currentPage < totalPages - 1) {
                        currentPage++;
                        showPage(currentPage);
                    }
                });

                // Initialize
                if (totalPages > 1) {
                    showPage(0);
                } else {
                    // Hide pagination if only one page
                    document.getElementById('roomsPagination').style.display = 'none';
                }
            }
        });
    </script>
}

